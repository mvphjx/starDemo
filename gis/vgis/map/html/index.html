<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="stylesheet" href="../js/openlayers/4.6.5/ol.css" />
    <link rel="stylesheet" href="../js/openlayers/popup/ol-popup.css" />
    <link rel="stylesheet" href="../js/openlayers/4.6.5/ext/ol-ext.min.css" />
    <link rel="stylesheet" href="../css/common_reset.css" />
    <link rel="stylesheet" href="../css/common_plugin.css" />
    <link rel="stylesheet" href="../css/common_main.css" />
    <link rel="stylesheet" href="../css/zTreeStyle/zTreeStyle.css" type="text/css" />
    <link href="../css/videoInvest.css" rel="stylesheet" type="text/css">
    <link href="../css/videoInvest_cicular.css" rel="stylesheet" type="text/css">

    <script src="../js/videoInvest/qwebchannel.js"></script>
    <script>
        new QWebChannel(qt.webChannelTransport, function (channel) {window.VisMapJsInteract = channel.objects.VisMapJsInteract;});
    </script>
    <script src="../js/openlayers/4.6.5/ol-debug.js"></script>
    <script src="../js/openlayers/popup/ol-popup.js"></script>
    <script src="../js/openlayers/4.6.5/turf.min.js"></script>
    <script src="../js/jquery/jquery-3.3.1.min.js"></script>
    <script src="../js/jquery/jquery.ztree.core.js"></script>
    <script src="../js/jquery/circular.min.js"></script>
</head>

<body style="width:100%;height:100%">
    <div id="map" style="width:100%;height:100%"></div>

    <!--搜索功能 搜索框-->
    <div class="search_box" style="display: none">
        <input type="text" class="searchInput" onfocus="searchBoxObj.onfocus()"  onkeypress="if(window.event.keyCode == '13')searchBoxObj.doSearch()"/>
        <i class="clear" ></i>
        <button onclick="searchBoxObj.doSearch()"></button>
        <button class="camera_list" onclick="searchBoxObj.showCameraTree()"></button>
    </div>

    <!-- 搜索功能 结果列表 -->
    <div class="left_box" >
        <div class="search_theme source_type">
            <ul class="tab_list">
                <li class="on" name="search_type">资源类型</li>
                <li name="camera_tree"></li>
            </ul>
            <div class="tab_item">
                <div class="theme_list">
                    <span name="1" typeName="" >联网视频</span>
                    <span name="camera" typeName="camera" class="on">社会视频</span>
                    <span name="3" typeName=""  >治安卡口</span>
                    <span name="6" typeName="" >wifi热点</span>
                    <span name="7" typeName="" >案事件</span>
                    <span name="8" typeName="">网吧</span>
                </div>
                <div class="ul_details" style="display: none;">
                    <p class="loading" style="display: none;">查询中...</p>
                    <p>共找到相关结果
                        <span id="searchCount">-</span>个</p>
                    <span class="ul_deails_close" onclick="ulDetailsObj.hide()">X</span>
                    <div class="details_text_box"></div>
                </div>
            </div>
        </div>
        <div class="search_theme camera_tree">
            <ul class="tab_list">
                <li class="on" name="search_type">摄像头树</li>
            </ul>
            <div class="tab_item">
                <div id="camera_org_tree" class="ztree" style="height: 820px; overflow: auto">摄像头树</div>
            </div>
        </div>
    </div>

    <!-- 工具框 -->
    <div class="tool_box" style="display: none">
        <ul class="tool_tool">
            <li class="one" index="0">选择</li>
            <li class="two" index="1">工具</li>
            <!--<li class="three" index="2">模式</li>-->
            <!--<li class="four" index="3">防空圈</li>-->
            <li class="five" index="2">图层</li>
        </ul>
        <div>
            <div class="tool_details tool">
                <ul>
                    <li class="line" onclick="selectArea('LineString')">循线</li>
                    <li class="dot" onclick="selectArea('Point')">侦查圈</li>
                    <li class="distance">
                        <input id="areadistance"  onkeyup="(this.v=function(){this.value=this.value.replace(/[^0-9-]+/,'');}).call(this)" value="200"  />米
                    </li>
					<li class="polygon" onclick="selectArea('Polygon')">多边形</li>
                    <li class="empty" onclick="$('ul.button_list').hide();toolBoxObj.clearSelect()">清空</li>
                </ul>
            </div>

            <div class="tool_details2 tool">
                <ul>
                    <li class="line" onclick="drawPlugin.draw('LineString')">线条</li>
                    <li class="location" onclick="drawPlugin.draw('Point')">标记</li>
                    <li class="polygon" onclick="drawPlugin.draw('Polygon')">多边形</li>
                    <li class="circle" onclick="drawPlugin.draw('Circle')">圆圈</li>
                    <li class="arrows" onclick="drawlinearrowsPlugin.draw()">箭头</li>
                    <li class="distance" onclick="measurePlugin.lengthArea('LineString')">距离</li>
                    <li class="area" onclick="measurePlugin.lengthArea('Polygon')">面积</li>
                    <li class="empty" onclick="toolBoxObj.clearDraw()">清空</li>
                </ul>
            </div>

            <div class="tool_details3 tool">
                <ul>
                    <li class="line" onclick="manylayerPlugin.toggleHeatmap()">热力</li>
                    <li class="location">影像</li>
                    <li class="polygon">混合</li>
                </ul>
            </div>
            <div class="tool_details4 tool">
                <span>
                    <input type="checkbox" value="" name="" />显示/隐藏</span>
                <button>设置</button>
                <button>防控圈</button>
                <button>清除</button>
            </div>
            <div class="tool_details5 tool">
                <ul>
                    <!--<li class="line" onclick="selectArea('LineString')">循线</li>
                    <li class="line" onclick="selectArea('LineString')">循线</li>-->
                    <li ><a>联网视频</a></li>
                    <li ><a>社会视频</a></li>
                    <li ><a>治安卡口</a></li>
                    <li ><a>wifi热点</a></li>
                    <li ><a>案事件</a></li>
                    <li ><a>网吧</a></li>
                </ul>
            </div>
        </div>
    </div>
    <ul class="button_list">
        <li>
            <button name="anniu1">下载视频</button>
        </li>
        <li>
            <button name="anniu2">检索</button>
        </li>
        <li>
            <button name="cancel">取消</button>
        </li>
    </ul>
</body>

</html>
<!--地图常量、常用工具函数、配置、初始化 -->
<script type="text/javascript" src="../js/globalconstant.js"></script>
<script type="text/javascript" src="../js/mapTool.js"></script>
<script type="text/javascript" src="../js/gc02map.js"></script>
<script src="../js/openlayers/4.6.5/ext/ol-ext.js"></script>
<!--地图各种插件 -->
<script src="../js/openlayers/plugin/MeasurePlugin.js" type="text/javascript"></script>
<script src="../js/openlayers/plugin/DrawPlugin.js" type="text/javascript"></script>
<script src="../js/openlayers/plugin/AreatoolPlugin.js" type="text/javascript"></script>
<script src="../js/openlayers/plugin/DrawlinearrowsPlugin.js" type="text/javascript"></script>
<script src="../js/openlayers/util/intersect.js" type="text/javascript"></script>
<script src="../js/openlayers/plugin/SelectPlugin.js" type="text/javascript"></script>
<script src="../js/openlayers/plugin/pathPlugin.js" type="text/javascript"></script>

<script src="../js/callback.js" type="text/javascript"></script>
<!--回调抽象对象 -->
<script src="../js/videoInvest/callbackImpl.js" type="text/javascript"></script>
<!--回调抽象对象实现 -->
<script src="../js/commonContent.js" type="text/javascript"></script>
<script src="../js/videoInvest/customContent.js" type="text/javascript"></script>
<!--自定义页面列表等内容 -->
<script type="text/javascript">
    cameraOrgTree.init();
</script>
<script src="../js/videoInvest/customStyle.js" type="text/javascript"></script>
<!--自定义图层、元素特效样式、泡泡 -->
<script src="../js/videoInvest/businessInterface.js" type="text/javascript"></script>
<!--对外特有业务接口 -->
<script src="../js/interface.js" type="text/javascript"></script>
<!--对外公共接口 -->
<script type="text/javascript">
   var options={
                    tileUrl:"http://localhost/map",
                    defaultLon:116.29570551767891,
                    defaultLat:39.82209837478379,
                    defaultlevel:13,
                    minlevel:1,
                    maxlevel:18,
                    geoserverWfs:"http://192.168.0.128:8282/geoserver-gis/wfs"
                }
    mapInit(options);
    setToolBarVisable(true);
    setSearchBoxVisable(true);
    mapTool.createLayer('camera', 'cluster');//创建摄像头图层
    var controlTip = mapTool.createTip();//创建操作盘
    var detailTip = mapTool.createTip();//详情Tip
    detailTip.setOffset([14, -17]);
    detailTip.setPositioning('bottom-center');

    //框选回调
    function selectArea(type) {
        $('ul.button_list').hide();
        toolBoxObj.clearSelect();
        var  features = [];
        selectPlugin.draw(type, $("#areadistance").val(), function (coordinates, event, mileOut, plugin) {
            plugin.boundary(mileOut);
            var points = plugin.select(coordinates, event, mileOut);
            for (var i = 0; i < points.length; i++) {
                if (points[i].get("features") != null) {
                    features = features.concat(points[i].get("features"));
                } else {
                    features.push(points[i]);
                }
            }
            var geoGson = new ol.format.GeoJSON({
                defaultDataProjection: "EPSG:4326",
                featureProjection: appMap.map.getView().getProjection()
            });
            ulDetailsObj.renderData('camera', geoGson.writeFeaturesObject(features));
            var position = event.target.downPx_;//debug版本取值
            if(position==undefined){
                position = event.target.ca//非debug版本取值
            }
            $("ul.button_list").css({ "left": position[0] + "px", "top": position[1] + "px" }).show();
            buttonList.setData(features);
        });
    }
</script>